<?php
// $Id$

/**
 * This module provides integration with the clicktale user tracking service
 * 
 * Development of this module was done by Coworks.be
 * @author Kurt Maet <kurt@coworks.be>
 * 
 * @TODO: 
 * - make the "ClickTale" path dynamic (search for the php files, if not found, error)
 * - Generate ("fill") the XML file
 */

require_once('clicktale.configurations.inc');

/*
 * Implementation of hook_perm().
 */
function clicktale_perm() {
  return array('administer clicktale');
}

/*
 * Implementation of hook_menu().
 * Admin settings form for the clicktale module
 */
function clicktale_menu() {
  $items = array();
  $items['admin/settings/clicktale'] = array(
    'title' => 'Clicktale',
    'description' => t('Settings for the use of Clicktale tracking service.'),
    'page callback' => 'drupal_get_form',
    'page arguments' => array('clicktale_admin_settings_form'),
    'access arguments' => array('administer clicktale'),
    'file' => 'clicktale.admin.inc',
    'type' => MENU_NORMAL_ITEM, 
  );
  
  $items['admin/settings/clicktale/main'] = array(
    'title' => 'Account settings',
    'description' => t('Account settings to connect to your Clicktale account.'),
    'type' => MENU_DEFAULT_LOCAL_TASK);
  
  $items['admin/settings/clicktale/configurations'] = array(
    'title' => 'Configurations',
    'description' => t('Clicktale configurations.'),
    'page arguments' => array('clicktale_configurations'),
    'page callback' => 'drupal_get_form',
    'access arguments' => array('administer clicktale'),
    'file' => 'clicktale.configurations.inc',
    'type' => MENU_LOCAL_TASK, 
  );
  
  return $items;
}


function clicktale_init() {
  global $_clicktale_do_count;
  $_clicktale_do_count = _clicktale_track_for_user();
  $path = variable_get('ClickTale_PHP_Kit', '') . "/ClickTaleTop.php";
  if ($_clicktale_do_count && file_exists($path)) {
    require_once($path);
  }
}

function clicktale_exit() {
  global $_clicktale_do_count;
  $path = variable_get('ClickTale_PHP_Kit', '') . "/ClickTaleBottom.php";
  if ($_clicktale_do_count && file_exists($path)) {
    require_once($path);
  }
}

/*
function clicktale_footer() {
  //$top = file_get_contents($thismod.'/js/clicktale-top.js');
  $top = file_get_contents(drupal_get_path('module', 'clicktale').'/js/clicktale-top.js');
  
  $project = variable_get('clicktale_project','');
  if($project !== '') {
    $bottom = file_get_contents(drupal_get_path('module', 'clicktale').'/js/clicktale-bottom.js');
    $bottom = str_replace('$$$CLICKTALE_ID$$$', variable_get('clicktale_id',''), $bottom);
    $bottom = str_replace('$$$CLICKTALE_RATIO$$$', variable_get('clicktale_ratio','0.1'), $bottom);
    $bottom = str_replace('$$$CLICKTALE_PARTITION$$$', variable_get('clicktale_partition','www'), $bottom);
    return($bottom);
  }
  return '<!-- no Clicktale project -->';
}
*/
